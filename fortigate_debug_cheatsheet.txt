FortiGate Debug Cheat Sheet (Standardized Placeholders)

Placeholders:
  <srcip>   = source IP address
  <dstip>   = remote/destination IP address
  <proto>   = protocol (e.g. tcp, udp, icmp or 6/17/1 depending on command)
  <dstport> = destination TCP/UDP port


1. Global debug boilerplate
---------------------------

Always start with:

  diag debug reset
  diag debug disable
  diag debug console timestamp enable
  diag debug duration 0          # extend debug beyond 30 min default

Optional (see CLI commands being executed by you / GUI):

  diag debug cli 1      # enable CLI debug
  diag debug cli 0      # disable CLI debug


2. Traffic / Policy / Session (flow debug)
------------------------------------------

Basic “what policy is hitting / why dropped?”:

  diag debug reset
  diag debug disable
  diag debug flow filter clear
  diag debug flow filter saddr <srcip>
  diag debug flow filter daddr <dstip>
  # or filter by destination port:
  # diag debug flow filter dport <dstport>

  diag debug flow show console enable
  diag debug flow trace start 100
  diag debug enable

Stop when done:

  diag debug disable
  diag debug flow trace stop
  diag debug flow filter clear

Useful variations:

  diag debug flow filter proto <proto>        # e.g. 6 for TCP, 17 for UDP
  diag debug flow filter vd <vdom>           # specific VDOM
  diag debug flow show function-name enable

Session table workflow (pair with flow debug):
----------------------------------------------

  diagnose sys session filter clear
  diagnose sys session filter src <srcip>
  diagnose sys session filter dst <dstip>
  diagnose sys session filter sport <dstport>
  diagnose sys session filter dport <dstport>
  diagnose sys session filter proto <proto>
  diagnose sys session list
  diagnose sys session clear                 # clears filtered sessions only
  diagnose firewall iprope list


3. Packet capture (on-box sniffer)
----------------------------------

Quick live capture:

  diag sniffer packet <interface> "<filter>" <verbose> <count>

Examples using standardized placeholders:

  # Capture all traffic to/from a specific host
  diag sniffer packet any "host <srcip>" 4 0

  # Capture a specific protocol and destination port to a remote IP
  diag sniffer packet port1 "<proto> port <dstport> and host <dstip>" 4 50

  # Capture a subnet (no placeholders needed here)
  diag sniffer packet port2 "net 192.168.1.0/24" 3 0

Verbosity:
  1 = basic
  2 = with MAC
  3 = include more header info
  4 = include payload hex

Network diagnostics quick reference
-----------------------------------

  execute ping-options repeat 5 size 1200
  execute ping <dstip>
  execute traceroute <dstip>
  get system arp
  diagnose ip arp list
  diagnose netlink brctl list
  diagnose netlink brctl name host <switch-name>
  get system interface
  get sys interface physical
  diagnose ip address list
  diagnose hardware deviceinfo nic <interface>
  get hardware nic <interface>
  get sys interface transceiver


4. IPsec VPN debug
------------------

IKE negotiation:

  diag debug reset
  diag debug disable
  diag debug console timestamp enable

  diagnose vpn ike log filter clear
  (Starting from v7.4.1, the syntax uses 'diagnose vpn ike log filter')
  diagnose vpn ike log filter loc-addr4 <srcip>     # local gateway IP (FortiGate side)
  diagnose vpn ike log filter rem-addr4 <dstip>     # remote gateway IP
  diagnose vpn ike log filter name <phase1-name>    # optional

  diagnose debug app ike -1
  diagnose debug enable

Stop debug:

  diagnose debug disable
  diagnose debug app ike 0
  diagnose vpn ike log filter clear

Available filter options:
  list             - Display the current filter
  clear            - Erase the current filter
  vd               - Index of virtual domain. -1 matches all
  name             - Phase1 name to filter by
  ifindex          - Index of the interface that IKE connection is negotiated over
  loc-addr4        - IPv4 local gateway address range to filter by
  mloc-addr4       - Multiple IPv4 local gateway address to filter by
  rem-addr4        - IPv4 remote gateway address range to filter by
  mrem-addr4       - Multiple IPv4 remote gateway address to filter by
  loc-addr6        - IPv6 local gateway address range to filter by
  mloc-addr6       - Multiple IPv6 local gateway address to filter by
  rem-addr6        - IPv6 remote gateway address range to filter by
  mrem-addr6       - Multiple IPv6 remote gateway addresses to filter by
  dst-port         - Destination port range to filter by
  negate           - Negate existing setting of the specified filter parameter

Quick status checks:

  diag vpn ike gateway list
  diag vpn tunnel list
  diag vpn tunnel flush           # clears SA (careful in production)

IPsec traffic / selectors:

  diag debug app IPsec -1
  diag debug enable
  # generate traffic
  diag debug disable
  diag debug app IPsec 0


5. SSL VPN debug
----------------

Core SSL VPN:

  diag debug reset
  diag debug disable

  diag debug app sslvpn -1
  diag debug enable
  # user connects now
  diag debug disable
  diag debug app sslvpn 0

User authentication (SAML/LDAP/RADIUS/etc.):

  diag debug reset
  diag debug disable

  diag debug app fnbamd -1
  diag debug app sslvpn -1        # often useful together
  diag debug enable
  # user attempts login
  diag debug disable

  diag debug app fnbamd 0
  diag debug app sslvpn 0

VPN status:

  diag vpn ssl stats
  diag vpn ssl list


6. Routing and connectivity
---------------------------

General route table:

  get router info routing-table all
  get router info routing-table database

ECMP / policy route issues – check:

  diagnose router policy list
  diag ip route list

Dynamic routing debug:

OSPF (auto-disables after ~30 minutes):

  diagnose ip router ospf all enable
  diagnose ip router ospf level info

BGP:

  diag debug reset
  diag debug disable

  diag debug app bgp -1
  diag debug enable
  # cause route changes / resets
  diag debug disable
  diag debug app bgp 0


7. User authentication / FSSO / SSO
-----------------------------------

General auth engine:

  diag debug reset
  diag debug disable

  diag debug app fnbamd -1
  diag debug enable
  # attempt login (VPN, captive portal, etc.)
  diag debug disable
  diag debug app fnbamd 0

FSSO:

  diag debug app fnbamd -1
  diag debug app wad -1          # for proxy/explicit
  diag debug enable
  # generate traffic
  diag debug disable
  diag debug app fnbamd 0
  diag debug app wad 0

Check login sessions:

  diag firewall auth list


8. High Availability (HA)
-------------------------

HA status:

  get sys ha status
  diag sys ha status
  diag sys ha history

HA debug (be careful, can be quite verbose):

  diag debug reset
  diag debug disable

  diag debug app hatalk -1
  diag debug app had -1
  diag debug enable
  # perform HA failover / wait for event
  diag debug disable

  diag debug app hatalk 0
  diag debug app had 0


9. UTM: IPS, Application Control, Web Filter
--------------------------------------------

These debugs get noisy fast; use only when you actually need them.

IPS:

  diag debug reset
  diag debug disable

  diag debug app ipsmonitor -1
  diag debug enable
  # generate traffic
  diag debug disable
  diag debug app ipsmonitor 0

Application Control / Web filtering via WAD:

  diag debug reset
  diag debug disable

  diag debug app wad -1
  diag debug enable
  # browse / generate HTTP(S) traffic
  diag debug disable
  diag debug app wad 0

Web filter/logging checks:

  diag webfilter status
  diag debug app urlfilter -1
  diag debug enable
  diag debug disable
  diag debug app urlfilter 0


10. System / Hardware / Performance
-----------------------------------

Core system triage:

  get system status
  execute time
  get system performance status
  get system performance top
  diag sys top                       # real-time, press q to quit
  diag sys session stat
  diag sys session exp-stat
  diag sys vd list
  diag sys cmdb info
  diag debug crashlog read
  diag sys process pidof <daemon>
  diag sys process dump <PID>
  diag sys process pstack <PID>
  diag sys process trace <PID>
  diag sys mpstat 5
  diag sys kill 11 <PID>             # send signal 11 to stuck process

Hardware health:

  diagnose hardware sysinfo interrupts
  diagnose hardware sysinfo memory
  diagnose hardware deviceinfo disk
  diagnose hardware test suite all
  diagnose sys flash list
  execute disk list
  execute disk format <partition-ref>
  diagnose disktest device <device>
  diagnose disktest block <block>
  diagnose disktest size <mb>
  execute formatlogdisk
  diagnose firewall packet distribution

Factory reset (use with caution):

  execute factoryreset {keepvmlicense}
  execute factoryreset-shutdown {keepvmlicense}
  execute factoryreset2 {keepvmlicense}

Process/logging debug:

  diag debug app miglogd -1
  diag debug enable
  diag debug disable
  diag debug app miglogd 0


11. FortiGuard & logging helpers
--------------------------------

FortiGuard update checks:

  diagnose debug rating
  diagnose debug application update -1
  diagnose debug enable
  execute update-now
  diagnose autoupdate status
  diagnose autoupdate versions

Logging workflow:

  diagnose log test
  execute log filter <filter>
  execute log filter                      # show current filter
  exec log display
  execute log delete
  execute log fortianalyzer testconnectivity
  diag debug app miglogd -1               # see also section 10
  diag debug enable
  diag debug disable
  diag debug app miglogd 0


12. Always turn it off
----------------------

When in doubt, clean up:

  diag debug disable
  diag debug reset
  diag debug cli 0
